<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en"
      data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-image="none" data-preloader="disable"
      data-theme="default" data-theme-colors="default">
<head>
    <meta charset="UTF-8">
    <title>Quản lý sản phẩm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description"/>
    <meta content="Themesbrand" name="author"/>
    <style>
        .disabled {
            pointer-events: none;
            opacity: 0.5;
        }
    </style>

    <link rel="shortcut icon" href="images/shoes.png">
    <!-- Thêm Line Awesome CDN -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/line-awesome/1.3.0/line-awesome/css/line-awesome.min.css">
    <!-- Thêm Material Design Icons CDN -->
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet">
    <!-- Thêm Feather Icon CND -->
    <script src="https://unpkg.com/feather-icons"></script>
    <!-- Thêm Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Thêm link tới Boxicons CDN -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- jsvectormap css -->
    <link href="css/jsvectormap.min.css" rel="stylesheet" type="text/css"/>

    <!--Swiper slider css-->
    <link href="css/swiper-bundle.min.css" rel="stylesheet" type="text/css"/>

    <!-- Layout config Js -->
    <script src="js/layout.js"></script>
    <!-- Bootstrap Css -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    n<!-- Icons Css -->
    <link href="css/icons.min.css" rel="stylesheet" type="text/css"/>
    <!-- App Css-->
    <link href="css/app.min.css" rel="stylesheet" type="text/css"/>
    <!-- custom Css-->
    <link href="css/custom.min.css" rel="stylesheet" type="text/css"/>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<!-- Begin page -->
<div id="layout-wrapper">

    <header id="page-topbar">
        <div class="layout-width">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box horizontal-logo">
                        <a href="/trangchuadmin" class="logo logo-dark">
                        <span class="logo-sm">
                            <img src="images/shoes.png" alt="" height="22">
                        </span>
                            <span class="logo-lg">
                            <h1 class="mt-3" style="color: #abb9e8">FSneaker</h1>
                        </span>
                        </a>

                        <a href="/trangchuadmin" class="logo logo-light">
                        <span class="logo-sm">
                            <img src="images/shoes.png" alt="" height="22">
                        </span>
                            <span class="logo-lg">
                            <h1 class="mt-3" style="color: #abb9e8">FSneaker</h1>
                        </span>
                        </a>
                    </div>

                    <button type="button"
                            class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger material-shadow-none"
                            id="topnav-hamburger-icon">
                    <span class="hamburger-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                    </button>
                </div>

                <div class="d-flex align-items-center">
                    <div class="dropdown ms-sm-3 header-item topbar-user"
                         th:if="${#authentication.name != 'anonymousUser'}">
                        <button type="button" class="btn material-shadow-none" id="page-header-user-dropdown"
                                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="d-flex align-items-center">
                            <img class="rounded-circle header-profile-user" src="images/users/avatar-1.jpg"
                                 alt="Header Avatar">
                            <span class="text-start ms-xl-2">
                                <span class="d-none d-xl-inline-block ms-1 fw-medium user-name-text"
                                      th:text="${#authentication.principal.displayName}"></span>
                                <span class="d-none d-xl-block ms-1 fs-12 user-name-sub-text" th:text="${#authentication.principal.role == 'ROLE_ADMIN' ? 'Admin' : (#authentication.principal.role == 'ROLE_MANAGER' ? 'Quản lý' : 'Nhân viên')}">Trưởng nhóm</span>
                            </span>
                        </span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" th:if="${#authentication.name != 'anonymousUser'}">
                            <!-- item-->
                            <h6 class="dropdown-header">Xin chào <span
                                    th:text="${#authentication.principal.displayName}"></span></h6>
                            <a class="dropdown-item" href="/thongtinadmin"><i
                                    class="mdi mdi-account-circle text-muted fs-16 align-middle me-1"></i> <span
                                    class="align-middle">Thông tin cá nhân</span></a>
                            <a class="dropdown-item" href="/tinnhanadmin"><i
                                    class="mdi mdi-message-text-outline text-muted fs-16 align-middle me-1"></i> <span
                                    class="align-middle">Tin nhắn</span></a>
                            <a class="dropdown-item" href="/trogiupadmin"><i
                                    class="mdi mdi-lifebuoy text-muted fs-16 align-middle me-1"></i> <span
                                    class="align-middle">Trợ giúp</span></a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="/caidatadmin"><span
                                    class="badge bg-success-subtle text-success mt-1 float-end">New</span><i
                                    class="mdi mdi-cog-outline text-muted fs-16 align-middle me-1"></i> <span
                                    class="align-middle">Cài đặt</span></a>
                            <a class="dropdown-item" href="/khoamanhinhadmin"><i
                                    class="mdi mdi-lock text-muted fs-16 align-middle me-1"></i> <span
                                    class="align-middle">Khóa màn hình</span></a>
                            <a class="dropdown-item" href="/logout"><i
                                    class="mdi mdi-logout text-muted fs-16 align-middle me-1"></i> <span
                                    class="align-middle" data-key="t-logout">Đăng xuất</span></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- ========== App Menu ========== -->
    <div class="app-menu navbar-menu">
        <!-- LOGO -->
        <div class="navbar-brand-box">
            <!-- Dark Logo-->
            <a href="/trangchuadmin" class="logo logo-dark">
                    <span class="logo-sm">
                        <img src="images/shoes.png" alt="" height="22">
                    </span>
                <span class="logo-lg">
                        <h1 class="mt-3" style="color: #abb9e8">FSneaker</h1>
                    </span>
            </a>
            <!-- Light Logo-->
            <a href="/trangchuadmin" class="logo logo-light">
                    <span class="logo-sm">
                        <img src="images/shoes.png" alt="" height="22">
                    </span>
                <span class="logo-lg">
                       <h1 class="mt-3" style="color: #abb9e8">FSneaker</h1>
                    </span>
            </a>
            <button type="button" class="btn btn-sm p-0 fs-20 header-item float-end btn-vertical-sm-hover"
                    id="vertical-hover">
                <i class="ri-record-circle-line"></i>
            </button>
        </div>
        <div id="scrollbar">
            <div class="container-fluid">
                <div id="two-column-menu">
                </div>
                <ul class="navbar-nav" id="navbar-nav" data-simplebar="init">
                    <li class="menu-title"><span data-key="t-menu">Menu</span></li>
                    <li class="nav-item" sec:authorize="hasRole('MANAGER')">
                        <a class="nav-link menu-link" href="#sidebarDashboards" data-bs-toggle="collapse" role="button"
                           aria-expanded="false" aria-controls="sidebarDashboards">
                            <i class="ri-dashboard-2-line"></i> <span data-key="t-dashboards">Thống kê</span>
                        </a>
                        <div class="collapse menu-dropdown" id="sidebarDashboards">
                            <ul class="nav nav-sm flex-column">


                                <li class="nav-item">
                                    <a href="/trangchuadmin" class="nav-link" data-key="t-ecommerce"> Doanh thu </a>
                                </li>
                            </ul>
                        </div>
                    </li> <!-- end Dashboard Menu -->
                    <li class="nav-item" sec:authorize="hasRole('MANAGER')">
                        <a class="nav-link menu-link" href="#sidebarApps" data-bs-toggle="collapse" role="button"
                           aria-expanded="false" aria-controls="sidebarApps">
                            <i class="ri-apps-2-line"></i> <span data-key="t-apps">Quản lý</span>
                        </a>
                        <div class="collapse menu-dropdown" id="sidebarApps">
                            <ul class="nav nav-sm flex-column">
                                <li class="nav-item">
                                    <a href="#sidebarCalendar" class="nav-link" data-bs-toggle="collapse" role="button"
                                       aria-expanded="false" aria-controls="sidebarCalendar" data-key="t-calender">
                                        Quản lý thuộc tính
                                    </a>
                                    <div class="collapse menu-dropdown" id="sidebarCalendar">
                                        <ul class="nav nav-sm flex-column">
                                            <li class="nav-item">
                                                <a href="/qlkichthuoc" class="nav-link" data-key="t-main-calender"> Kích
                                                    thước</a>
                                            </li>
                                            <li class="nav-item">
                                                <a href="/qlmausac" class="nav-link" data-key="t-month-grid"> Màu
                                                    sắc </a>
                                            </li>
                                            <li class="nav-item">
                                                <a href="/qlthuonghieu" class="nav-link"> Thương hiệu </a>
                                            </li>
                                            <li class="nav-item">
                                                <a href="/qlxuatxu" class="nav-link"> Xuất xứ</a>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="nav-item">
                                    <a href="/qlsanpham" class="nav-link" data-key="t-sanpham">Quản lý sản phẩm</a>
                                </li>
                                <li class="nav-item">
                                    <a href="/qlvoucher" class="nav-link" data-key="t-voucher"> Quản lý voucher </a>
                                </li>
                                <li class="nav-item">
                                    <a href="/qlkhuyenmai" class="nav-link" data-key="t-khuyenmai"> Quản lý chương trình
                                        khuyến mãi </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-item" sec:authorize="hasAnyRole('MANAGER','STAFF')">
                        <a class="nav-link menu-link" href="/don-hang/hien-thi">
                            <i class="ri-store-line"></i> <span data-key="t-layouts">Bán hàng</span>
                        </a>

                    </li> <!-- end Dashboard Menu -->
                    <li class="nav-item" sec:authorize="hasAnyRole('MANAGER','STAFF')">
                        <a class="nav-link menu-link" href="/donhangadmin">
                            <i class="ri-file-text-line"></i> <span data-key="t-layouts">Đơn hàng</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link menu-link" href="#sidebarAuth" data-bs-toggle="collapse" role="button"
                           aria-expanded="false" aria-controls="sidebarAuth">
                            <i class="ri-account-circle-line"></i> <span data-key="t-auth">Tài khoản</span>
                        </a>
                        <div class="collapse menu-dropdown" id="sidebarAuth">
                            <ul class="nav nav-sm flex-column">
                                <li class="nav-item" sec:authorize="hasAnyRole('MANAGER','ADMIN')">
                                    <a href="/qlnhanvien" class="nav-link" data-key="t-nhanvien"> Nhân viên </a>
                                </li>
                                <li class="nav-item" sec:authorize="hasAnyRole('MANAGER','STAFF')">
                                    <a href="/qlkhachhang" class="nav-link" data-key="t-khachang"> Khách hàng </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
            <!-- Sidebar -->
        </div>

        <div class="sidebar-background"></div>
    </div>
    <!-- Left Sidebar End -->
    <!-- Vertical Overlay-->
    <div class="vertical-overlay"></div>

    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">
                <!-- COde tai day -->
                <h1>Quản lý sản phẩm</h1>
                <!-- Tabs nav -->
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" th:href="@{/qlsanpham}" th:classappend="${tab == 'home'} ? 'active' : ''">Sản
                            phẩm</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" th:href="@{/qlsanphamchitiet}"
                           th:classappend="${tab == 'profile'} ? 'active' : ''">Sản phẩm chi tiết</a>
                    </li>
                </ul>
                <!-- Tabs content -->
                <div class="tab-content" id="myTabContent">
                    <!-- Tab quản lý sản phẩm -->
                    <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab"
                         th:classappend="${tab == 'home'} ? 'show active' : ''">
                        <div class="card">
                            <div class="card-header">
                                <h1 class="card-title mb-0">Sản phẩm</h1>
                            </div>
                            <div class="card-body">
                                <div class="serchSanPham">
                                    <form action="/qlsanpham" method="get" class="form-inline mb-3"
                                          style="border: #0dcaf0;">
                                        <div class="row g-2 align-items-end">
                                            <div class="col-md-3">
                                                <label class="form-label">Tìm kiếm</label>
                                                <input type="text" name="serchSanPham" class="form-control"
                                                       th:value="${serchSanPham}"
                                                       placeholder="Nhập mã hoặc tên sản phẩm"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label class="form-label">Thương hiệu</label>
                                                <select name="idThuongHieu" class="form-select"
                                                        onchange="this.form.submit()">
                                                    <option value="" disabled selected>Chọn thương hiệu</option>
                                                    <option th:each="th : ${listThuongHieu}" th:value="${th.id}"
                                                            th:text="${th.tenThuongHieu}"
                                                            th:selected="${idThuongHieu != null && idThuongHieu == th.id}"></option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label class="form-label">Xuất xứ</label>
                                                <select name="idXuatXu" class="form-select"
                                                        onchange="this.form.submit()">
                                                    <option value="" disabled selected>Chọn xuất xứ</option>
                                                    <option th:each="xx : ${listXuatXu}" th:value="${xx.id}"
                                                            th:text="${xx.tenXuatXu}"
                                                            th:selected="${idXuatXu != null && idXuatXu == xx.id}"></option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <button type="submit" class="btn btn-primary btn-animation waves-effect waves-light"><i class="ri-search-line"></i> Tìm kiếm</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                                <button type="button" class="btn btn-primary btn-animation waves-light waves-effect" data-bs-toggle="modal"
                                        th:data-bs-target="'#addModal'">
                                    <i class="ri-add-line"></i> Thêm
                                </button>

                                <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel"
                                     aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="addModalLabel">Thêm sản phẩm</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <form id="productForm" th:action="@{/qlsanpham/store}" method="post">
                                                    <div class="mb-3">
                                                        <label class="form-label">Mã sản phẩm <span style="color: red">*</span></label>
                                                        <input type="text" class="form-control" name="maSanPham"
                                                               id="maSanPham" th:value="${maSanPham}">
                                                        <span id="maSanPhamError" style="color: #ff0000"></span>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label">Tên sản phẩm <span style="color: red">*</span></label>
                                                        <input type="text" class="form-control" name="tenSanPham"
                                                               id="tenSanPham" th:value="${tenSanPham}">
                                                        <span id="tenSanPhamError" style="color: #ff0000"></span>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label>Khuyến mãi</label>
                                                        <select name="khuyenMaiId" id="khuyenMaiId">
                                                            <option value="" selected>Chọn khuyến mãi</option>
                                                            <option th:each="km : ${listKhuyenMai}" th:value="${km.id}"
                                                                    th:text="${km.tenKhuyenMai}">
                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label>Thương hiệu  <span style="color: red">*</span></label>
                                                        <select name="thuongHieuId" id="thuongHieuId">
                                                            <option value="" selected>Chọn thương hiệu</option>
                                                            <option th:each="th : ${listThuongHieu}" th:value="${th.id}"
                                                                    th:text="${th.tenThuongHieu}">
                                                            </option>
                                                        </select>
                                                        <span id="thuongHieuError" style="color: #ff0000"></span>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label>Xuất xứ  <span style="color: red">*</span></label>
                                                        <select name="xuatXuId" id="xuatXuId">
                                                            <option value="" selected>Chọn xuất xứ</option>
                                                            <option th:each="xx : ${listXuatXu}" th:value="${xx.id}"
                                                                    th:text="${xx.tenXuatXu}">
                                                            </option>
                                                        </select>
                                                        <span id="xuatXuError" style="color: #ff0000"></span>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label">Trạng thái</label>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                   name="trangThai" value="1" checked>
                                                            <label class="form-check-label">Còn hàng</label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                   name="trangThai" value="0">
                                                            <label class="form-check-label">Hết hàng</label>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="submit" class="btn btn-primary btn-animation waves-effect waves-light">Lưu thay đổi
                                                        </button>
                                                        <button type="button" class="btn btn-secondary btn-animation waves-light waves-effect"
                                                                data-bs-dismiss="modal">Đóng
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Mã sản phẩm</th>
                                        <th>Tên sản phẩm</th>
                                        <th>Thương hiệu</th>
                                        <th>Xuất xứ</th>
                                        <th>Khuyến mãi</th>
                                        <th>Trạng thái</th>
                                        <th>Ngày tạo</th>
                                        <th>Hành động</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="sp,index : ${listSanPham}">
                                        <td>[[${index.index + 1}]]</td>
                                        <td>[[${sp.maSanPham}]]</td>
                                        <td>[[${sp.tenSanPham}]]</td>
                                        <td>[[${sp.thuongHieu.tenThuongHieu}]]</td>
                                        <td>[[${sp.xuatXu.tenXuatXu}]]</td>
                                        <td>[[${sp.khuyenMai?.tenKhuyenMai}]]</td>
                                        <td th:switch="${sp.trangThai}">
                                            <span th:case="1">Còn hàng</span>
                                            <span th:case="0">Hết hàng</span>
                                        </td>
                                        <td>[[${#dates.format(sp.ngayTao, 'dd-MM-yyyy')}]]</td>
                                        <td>
                                            <!-- Nút mở modal chỉnh sửa -->
                                            <button type="button" class="btn btn-primary btn-animation waves-light waves-effect" data-bs-toggle="modal"
                                                    th:data-bs-target="'#editModal' + ${sp.id}">
                                                <i class="ri-edit-line"></i> Sửa
                                            </button>

                                            <!-- Modal chỉnh sửa sản phẩm -->
                                            <div class="modal fade" th:id="'editModal' + ${sp.id}" tabindex="-1"
                                                 aria-labelledby="editLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="editLabel">Sửa sản
                                                                phẩm</h5>
                                                            <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="productEditForm" th:action="@{/qlsanpham/update}"
                                                                  method="post">
                                                                <!-- Hidden input để chứa ID sản phẩm -->
                                                                <input type="hidden" th:value="${sp.id}" name="id"/>

                                                                <!-- Mã sản phẩm -->
                                                                <div class="mb-3">
                                                                    <label class="form-label">Mã sản phẩm</label>
                                                                    <input type="text" class="form-control"
                                                                           th:value="${sp.maSanPham}" name="maSanPham">
                                                                    <span id="maSanPhamError1"
                                                                          style="color: #ff0000"></span>

                                                                </div>

                                                                <!-- Tên sản phẩm -->
                                                                <div class="mb-3">
                                                                    <label class="form-label">Tên sản phẩm</label>
                                                                    <input type="text" class="form-control"
                                                                           th:value="${sp.tenSanPham}"
                                                                           name="tenSanPham">
                                                                    <span id="tenSanPhamError1"
                                                                          style="color: #ff0000"></span>

                                                                </div>

                                                                <!-- Thương hiệu sản phẩm -->
                                                                <div class="mb-3">
                                                                    <label class="form-label">Thương hiệu</label>
                                                                    <select class="form-select" name="thuongHieuId">
                                                                        <option th:each="th : ${listThuongHieu}"
                                                                                th:value="${th.id}"
                                                                                th:text="${th.tenThuongHieu}"
                                                                                th:selected="${sp.thuongHieu.id == th.id}"></option>
                                                                    </select>
                                                                </div>

                                                                <!-- Xuất xứ sản phẩm -->
                                                                <div class="mb-3">
                                                                    <label class="form-label">Xuất xứ</label>
                                                                    <select class="form-select" name="xuatXuId">
                                                                        <option th:each="xx : ${listXuatXu}"
                                                                                th:value="${xx.id}"
                                                                                th:text="${xx.tenXuatXu}"
                                                                                th:selected="${sp.xuatXu.id == xx.id}"></option>
                                                                    </select>
                                                                </div>

                                                                <!--                                                     Khuyến mại-->
                                                                <div class="mb-3">
                                                                    <label class="form-label">Khuyến Mãi</label>
                                                                    <select class="form-select" name="khuyenMaiId">
                                                                        <option value="" th:selected="${sp.khuyenMai == null}">Không khuyến mãi</option>
                                                                        <option th:each="km : ${listKhuyenMai}"
                                                                                th:value="${km.id}"
                                                                                th:text="${km.tenKhuyenMai}"
                                                                                th:selected="${ sp.khuyenMai != null and sp.khuyenMai.id == km.id}">
                                                                        </option>
                                                                    </select>
                                                                </div>

                                                                <!-- Trạng thái sản phẩm -->
                                                                <div class="mb-3">
                                                                    <label class="form-label">Trạng thái</label>
                                                                    <select class="form-select" name="trangThai">
                                                                        <option value="1"
                                                                                th:selected="${sp.trangThai == 1}">Còn
                                                                            hàng
                                                                        </option>
                                                                        <option value="0"
                                                                                th:selected="${sp.trangThai == 0}">Hết
                                                                            hàng
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <!-- Nút submit cập nhật -->
                                                                <div class="modal-footer">
                                                                    <button type="submit" class="btn btn-primary">Lưu
                                                                        thay đổi
                                                                    </button>
                                                                    <button type="button" class="btn btn-secondary btn-animation waves-light waves-effect"
                                                                            data-bs-dismiss="modal">Đóng
                                                                    </button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                    </tbody>

                                </table>
                                <th:block th:if="${listSanPham !=null and listSanPham.totalPages > 1}">
                                    <nav aria-label="Page navigation">
                                        <ul class="pagination justify-content-center">
                                            <!-- Nút Previous -->
                                            <li class="page-item"
                                                th:classappend="${!listSanPham.hasPrevious()} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/qlsanpham(page=${listSanPham.number - 1}, serchSanPham=${param.serchSanPham}, idThuongHieu=${param.idThuongHieu}, idXuatXu=${param.idXuatXu})}">Previous</a>
                                            </li>
                                            <!-- Các số trang -->
                                            <th:block th:each="i : ${#numbers.sequence(0, listSanPham.totalPages - 1)}">
                                                <li class="page-item"
                                                    th:classappend="${i == listSanPham.number} ? 'active'">
                                                    <a class="page-link"
                                                       th:href="@{/qlsanpham(page=${i}, serchSanPham=${param.serchSanPham}, idThuongHieu=${param.idThuongHieu}, idXuatXu=${param.idXuatXu})}"
                                                       th:text="${i + 1}"></a>
                                                </li>
                                            </th:block>
                                            <!-- Nút Next -->
                                            <li class="page-item"
                                                th:classappend="${!listSanPham.hasNext()} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/qlsanpham(page=${listSanPham.number + 1}, serchSanPham=${param.serchSanPham}, idThuongHieu=${param.idThuongHieu}, idXuatXu=${param.idXuatXu})}">Next</a>
                                            </li>
                                        </ul>
                                    </nav>
                                </th:block>
                            </div>
                        </div>
                    </div>

                    <!-- Tab quản lý sản phẩm chi tiết -->
                    <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab"
                         th:classappend="${tab == 'profile'} ? 'show active' : ''">
                        <div class="card">
                            <div class="card-header">
                                <h1 class="card-title mb-0">Sản phẩm chi tiết</h1>
                            </div>
                            <div class="card-body">

                                <div class="search">
                                    <form action="/qlsanphamchitiet" method="get">
                                        <div class="row g-2">
                                            <div class="col-md-10">
                                                <label class="form-label">Tìm kiếm</label>
                                                <input type="text" class="form-control" name="searchSanPhamChiTiet"
                                                       th:value="${searchSanPhamChiTiet}"
                                                       placeholder="Nhập mã sản phẩm chi tiết để tìm kiếm">
                                            </div>
                                            <div class="col-md-2 d-flex align-items-end">
                                                <button type="submit" class="btn btn-primary btn-animation waves-effect waves-light"><i class="ri-search-line"></i> Tìm kiếm</button>
                                            </div>
                                        </div>
                                        <div class="row g-5 ">
                                            <div class="col-md-2">
                                                <label class="form-label">Sản phẩm</label>
                                                <select name="idSanPham" class="form-select"
                                                        onchange="this.form.submit()">
                                                    <option value="" disabled selected>Chọn sản phẩm</option>
                                                    <option th:each="sp : ${listSanPhams}" th:value="${sp.id}"
                                                            th:text="${sp.tenSanPham}"
                                                            th:selected="${idSanPham != null && idSanPham == th.id}"></option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label class="form-label">Màu sắc</label>
                                                <select name="idMauSac" class="form-select"
                                                        onchange="this.form.submit()">
                                                    <option value="" disabled selected>Chọn màu sắc</option>
                                                    <option th:each="ms : ${listMauSac}" th:value="${ms.id}"
                                                            th:text="${ms.tenMauSac}"
                                                            th:selected="${idMauSac != null && idMauSac == th.id}"></option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label class="form-label">Kích thước</label>
                                                <select name="idKichThuoc" class="form-select"
                                                        onchange="this.form.submit()">
                                                    <option value="" disabled selected>Chọn kích thước</option>
                                                    <option th:each="kt : ${listKichThuoc}" th:value="${kt.id}"
                                                            th:text="${kt.tenKichThuoc}"
                                                            th:selected="${idKichThuoc != null && idKichThuoc == th.id}"></option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="minPrice">Giá Thấp Nhất:</label>
                                                <input type="number" id="minPrice" name="minPrice">
                                            </div>
                                            <div class="col-md-2">
                                                <label for="maxPrice">Giá Cao Nhất:</label>
                                                <input type="number" id="maxPrice" name="maxPrice">
                                            </div>

                                        </div>
                                    </form>
                                </div>

                                <div class="mt-3">
                                    <button type="button" class="btn btn-primary btn-animation waves-light waves-effect" data-bs-toggle="modal"
                                            th:data-bs-target="'#addModal2'">
                                        <i class="ri-add-line"></i> Thêm
                                    </button>
                                </div>
                                <div class="modal fade" id="addModal2" tabindex="-1" aria-labelledby="addModalLabel2"
                                     aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="addModalLabel2">Thêm sản phẩm chi tiết</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <form th:action="@{/qlsanphamchitiet/store}"
                                                      id="productDetailInsertForm" method="post"
                                                      enctype="multipart/form-data">
                                                    <div class="row mb-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Mã sản phẩm chi tiết</label>
                                                            <input type="text" class="form-control"
                                                                   name="maSanPhamChiTiet"/>
                                                            <div id="maSanPhamChiTietError" style="color: #ff0000" class="error"></div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Số lượng</label>
                                                            <input type="number" class="form-control" name="soLuong"
                                                                   value="0"/>
                                                            <div id="soLuongError" class="error"></div>
                                                        </div>
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Giá bán</label>
                                                            <input type="number" class="form-control" name="giaBan"
                                                                   value="0"/>
                                                            <div id="giaBanError"  style="color: #ff0000" class="error"></div>

                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Ngày sản xuất</label>
                                                            <input type="date" class="form-control"  style="color: #ff0000" name="ngaySanXuat"/>

                                                        </div>

                                                    </div>


                                                    <div class="row mb-3">
                                                            <label class="form-label">Sản phẩm</label>
                                                            <select class="form-control" name="sanPhamId">
                                                                <option value="" disabled selected>Chọn sản phẩm
                                                                </option>
                                                                <option th:each="sp : ${listSanPhams}"
                                                                        th:value="${sp.id}" th:text="${sp.tenSanPham}">
                                                                    Sản phẩm
                                                                </option>
                                                            </select>
                                                    </div>

                                                    <div class="row mb-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Kích thước</label>
                                                            <select class="form-control" name="kichThuocIds"
                                                                    multiple="multiple">
                                                                <option value="" disabled selected>Chọn kích thước
                                                                </option>
                                                                <option th:each="kt : ${listKichThuoc}"
                                                                        th:value="${kt.id}"
                                                                        th:text="${kt.tenKichThuoc}">Kích thước
                                                                </option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Màu sắc</label>
                                                            <select class="form-control" name="mauSacIds"
                                                                    multiple="multiple">
                                                                <option value="" disabled selected>Chọn màu sắc</option>
                                                                <option th:each="ms : ${listMauSac}" th:value="${ms.id}"
                                                                        th:text="${ms.tenMauSac}">Màu sắc
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="row mb-3">
                                                        <label class="form-label">Trạng thái</label>
                                                        <div class="d-flex align-items-center">
                                                            <div class="form-check me-3">
                                                                <input class="form-check-input" type="radio"
                                                                       name="trangThai" value="1" checked/>
                                                                <label class="form-check-label">Còn hàng</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio"
                                                                       name="trangThai" value="0"/>
                                                                <label class="form-check-label">Hết hàng</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- hình ảnhh -->
                                                    <div class="mb-3">
                                                        <label class="form-label">Hình ảnh</label>
                                                        <input type="file" id="image" name="images" multiple/><br/>
                                                    </div>

                                                    <div class="modal-footer">
                                                        <button type="submit" class="btn btn-primary btn-animation waves-effect waves-light">Lưu thay đổi
                                                        </button>
                                                        <button type="button" class="btn btn-secondary btn-animation waves-light waves-effect"
                                                                data-bs-dismiss="modal">Đóng
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Mã sản phảm chi tiết</th>
                                        <th>Sản phẩm</th>
                                        <th> Kích thước</th>
                                        <th>Màu sắc</th>
                                        <th>Số lượng</th>
                                        <th>Giá bán</th>
                                        <th>Giá bán sau giảm</th>
                                        <th>Trạng thái</th>
                                        <th>Ngày sản xuất</th>
                                        <th>Images</th>
                                        <th>Hành động</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="spct,index : ${listSanPhamChiTiet}">
                                        <td>[[${index.index + 1}]]</td>
                                        <td>[[${spct.maSanPhamChiTiet}]]</td>
                                        <td>[[${spct.sanPham.tenSanPham}]]</td>
                                        <td>[[${spct.kichThuoc.tenKichThuoc}]]</td>
                                        <td>[[${spct.mauSac.tenMauSac}]]</td>
                                        <td>[[${spct.soLuong}]]</td>
                                        <td>[[${#numbers.formatDecimal(spct.giaBan, 0, 'COMMA', 0 , 'COMMA')}]]</td>
                                        <td>[[${#numbers.formatDecimal(spct.giaBanGiamGia, 0 ,'COMMA', 0, 'COMMA')}]]</td>
                                        <td th:switch="${spct.trangThai}">
                                            <span th:case="1">Còn hàng</span>
                                            <span th:case="0">Hết hàng</span>
                                        </td>
                                        <td th:text="${#dates.format(spct.ngaySanXuat, 'dd/MM/yyyy')}"></td>
                                        <td><img th:src="@{'/repository/' + ${#strings.arraySplit(spct.imanges, ',')[0]}}" width="100"
                                                 height="100"/></td>
                                        <td>
                                            <button type="button" class="btn btn-primary btn-animation waves-effect waves-light" data-bs-toggle="modal"
                                                    th:data-bs-target="'#editModal-' + ${spct.id}">
                                                <i class="ri-edit-line"></i> Sửa
                                            </button>

                                            <!-- Modal chỉnh sửa -->
                                            <div class="modal fade" th:id="'editModal-' + ${spct.id}" tabindex="-1"
                                                 aria-labelledby="editModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="editModalLabel">Chỉnh sửa sản
                                                                phẩm chi tiết</h5>
                                                            <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="productDetailEditForm"
                                                                  th:action="@{/qlsanphamchitiet/update}" method="post"
                                                                  enctype="multipart/form-data">
                                                                <input type="hidden" th:value="${spct.id}" name="id"/>
                                                                <div class="row mb-3">
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Mã sản phẩm chi
                                                                            tiết</label>
                                                                        <input type="text" class="form-control"
                                                                               th:value="${spct.maSanPhamChiTiet}"
                                                                               name="maSanPhamChiTiet" readonly>
                                                                        <div id="maSanPhamChiTietError1"
                                                                             class="error text-danger"></div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Số lượng</label>
                                                                        <input type="text" class="form-control"
                                                                               th:value="${spct.soLuong}"
                                                                               name="soLuong">
                                                                        <div id="soLuongError1"
                                                                             class="error text-danger"></div>
                                                                    </div>
                                                                </div>
                                                                <div class="row mb-3">
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Giá bán</label>
                                                                        <input type="text" class="form-control"
                                                                               th:value="${spct.giaBan}" name="giaBan">
                                                                        <div id="giaBanError1"
                                                                             class="error text-danger"></div>
                                                                    </div>

                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Ngày sản xuất</label>
                                                                        <input type="date" class="form-control"
                                                                               th:value="${spct.ngaySanXuat}"
                                                                               name="ngaySanXuat">
                                                                    </div>

                                                                </div>
                                                                <div class="row mb-3">
                                                                        <label class="form-label">Sản phẩm</label>
                                                                        <select class="form-select" name="sanPhamId">
                                                                            <option value="0" th:text="'Chọn sản phẩm'"
                                                                                    th:selected="${spct.sanPham.id == null}">
                                                                                Chọn sản phẩm
                                                                            </option>
                                                                            <!--    Mặc định ban đầu là Chọn sản phẩm- giá trị = 0-->
                                                                            <option th:each="sp : ${listSanPhams}"
                                                                                    th:value="${sp.id}"
                                                                                    th:text="${sp.tenSanPham}"
                                                                                    th:selected="${  spct.sanPham.id == sp.id}">
                                                                            </option>
                                                                        </select>
                                                                </div>
                                                                <div class="row mb-3">
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Màu sắc</label>
                                                                        <select class="form-select" name="mauSacId">
                                                                            <option value="0" th:text="'Chọn màu sắc'"
                                                                                    th:selected="${spct.mauSac.id == null}">
                                                                                Chọn kích thước
                                                                            </option>
                                                                            <option th:each="ms : ${listMauSac}"
                                                                                    th:value="${ms.id}"
                                                                                    th:text="${ms.tenMauSac}"
                                                                                    th:selected="${ spct.mauSac.id == ms.id}">
                                                                            </option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Kích thước</label>
                                                                        <select class="form-select" name="kichThuocId">
                                                                            <option value="0"
                                                                                    th:text="'Chọn kích thước'"
                                                                                    th:selected="${spct.kichThuoc.id == null}">
                                                                                Chọn kích thước
                                                                            </option>
                                                                            <option th:each="kt : ${listKichThuoc}"
                                                                                    th:value="${kt.id}"
                                                                                    th:text="${kt.tenKichThuoc}"
                                                                                    th:selected="${  spct.kichThuoc.id == kt.id}">
                                                                            </option>

                                                                        </select>
                                                                    </div>
                                                                </div>

                                                                <div class="row mb-3">
                                                                    <label class="form-label">Trạng thái</label>
                                                                    <div class="d-flex align-items-center">
                                                                        <div class="form-check me-3">
                                                                            <input class="form-check-input" type="radio"
                                                                                   name="trangThai" value="1"
                                                                                   th:checked="${spct.trangThai == 1}">
                                                                            <label class="form-check-label">Còn hàng</label>
                                                                        </div>
                                                                        <div class="form-check">
                                                                            <input class="form-check-input" type="radio"
                                                                                   name="trangThai" value="0"
                                                                                   th:checked="${spct.trangThai == 0}">
                                                                            <label class="form-check-label"> Hết hàng</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Hình ảnh hiện tại</label><br/>
                                                                    <!-- Hiển thị ảnh hiện tại -->
                                                                    <div id="currentImages">
                                                                        <!-- Duyệt qua các ảnh hiện tại (nếu có nhiều ảnh) -->
                                                                        <img th:each="image : ${spct.imanges.split(',')}"
                                                                             th:src="@{'../../images/product/' + ${image}}"
                                                                             alt="Ảnh sản phẩm" class="img-thumbnail"
                                                                             style="max-width: 150px; max-height: 150px; margin-right: 5px;">
                                                                    </div>
                                                                </div>

                                                                <div class="productDetail mb-3">
                                                                    <label class="form-label">Thay đổi hình ảnh</label><br/>
                                                                    <!-- Input để chọn nhiều ảnh -->
                                                                    <input type="file" class="imagee" name="imagees" multiple /><br/>
                                                                    <!-- Hiển thị bản xem trước các ảnh -->
                                                                    <div class="previewImagesContainer mt-2"></div>
                                                                </div>

                                                                <div class="modal-footer">
                                                                    <button type="submit" class="btn btn-primary btn-animation waves-light waves-effect">Lưu
                                                                        thay đổi
                                                                    </button>
                                                                    <button type="button" class="btn btn-secondary btn-animation waves-effect waves-light"
                                                                            data-bs-dismiss="modal">Đóng
                                                                    </button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <th:block th:if="${listSanPhamChiTiet != null and listSanPhamChiTiet.totalPages > 1}">
                                    <nav aria-label="Page navigation">
                                        <ul class="pagination justify-content-center">
                                            <!-- Previous Button -->
                                            <li class="page-item"
                                                th:classappend="${!listSanPhamChiTiet.hasPrevious()} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/qlsanphamchitiet(page=${listSanPhamChiTiet.number - 1}, searchSanPhamChiTiet=${param.searchSanPhamChiTiet}, idSanPham=${param.idSanPham}, idMauSac=${param.idMauSac}, minPrice=${param.minPrice}, maxPrice=${param.maxPrice})}">Previous</a>
                                            </li>
                                            <!-- Page Numbers -->
                                            <th:block
                                                    th:each="i : ${#numbers.sequence(0, listSanPhamChiTiet.totalPages - 1)}">
                                                <li class="page-item"
                                                    th:classappend="${i == listSanPhamChiTiet.number} ? 'active'">
                                                    <a class="page-link"
                                                       th:href="@{/qlsanphamchitiet(page=${i}, searchSanPhamChiTiet=${param.searchSanPhamChiTiet}, idSanPham=${param.idSanPham}, idMauSac=${param.idMauSac}, minPrice=${param.minPrice}, maxPrice=${param.maxPrice})}"
                                                       th:text="${i + 1}"></a>
                                                </li>
                                            </th:block>
                                            <!-- Next Button -->
                                            <li class="page-item"
                                                th:classappend="${!listSanPhamChiTiet.hasNext()} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/qlsanphamchitiet(page=${listSanPhamChiTiet.number + 1}, searchSanPhamChiTiet=${param.searchSanPhamChiTiet}, idSanPham=${param.idSanPham}, idMauSac=${param.idMauSac}, minPrice=${param.minPrice}, maxPrice=${param.maxPrice})}">Next</a>
                                            </li>
                                        </ul>
                                    </nav>
                                </th:block>
                                <script>
                                    document.querySelectorAll('.imagee').forEach(input => {
                                        input.addEventListener('change', function (event) {
                                            const files = event.target.files; // Lấy tất cả các file được chọn
                                            const previewContainer = event.target.closest('.productDetail').querySelector('.previewImagesContainer'); // Container chứa các ảnh xem trước

                                            // Xóa ảnh đã hiển thị trước đó
                                            previewContainer.innerHTML = '';

                                            // Nếu có ảnh được chọn
                                            if (files && files.length > 0) {
                                                Array.from(files).forEach(file => {
                                                    const reader = new FileReader();

                                                    reader.onload = function (e) {
                                                        const img = document.createElement('img');
                                                        img.src = e.target.result;
                                                        img.classList.add('img-thumbnail');
                                                        img.style.maxWidth = '150px';
                                                        img.style.maxHeight = '150px';
                                                        img.style.marginRight = '5px';

                                                        // Thêm ảnh vào container
                                                        previewContainer.appendChild(img);
                                                    };

                                                    reader.readAsDataURL(file); // Đọc file và tạo URL tạm thời
                                                });
                                            } else {
                                                previewContainer.innerHTML = '<p>Chưa có ảnh xem trước</p>';
                                            }
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- container-fluid -->
        </div>
        <!-- End Page-content -->

        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6">
                        © Velzon.
                    </div>
                    <div class="col-sm-6">
                        <div class="text-sm-end d-none d-sm-block">
                            Design & Develop by Themesbrand
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <!-- end main content-->

</div>
<!-- END layout-wrapper -->

<script th:if="${showAddModal}" type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
        var addModal = new bootstrap.Modal(document.getElementById('addModal'));
        addModal.show();
    });
</script>

<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/simplebar.min.js"></script>
<script src="js/waves.min.js"></script>
<script src="js/feather.min.js"></script>
<script src="js/lord-icon-2.1.0.js"></script>
<script src="js/plugins.js"></script>

<!-- apexcharts -->
<script src="js/apexcharts.min.js"></script>

<!-- Vector map-->
<script src="js/jsvectormap.min.js"></script>
<script src="js/world-merc.js"></script>

<!--Swiper slider js-->
<script src="js/swiper-bundle.min.js"></script>

<!-- Dashboard init -->
<script src="js/dashboard-ecommerce.init.js"></script>

<!-- App js -->
<script src="js/app.js"></script>
</body>
<script>
    $(document).ready(function () {
        $('#productForm').on('submit', function (e) {
            e.preventDefault();
            $('.error').text('');

            var formData = $(this).serialize() + '&isAjax=true';

            $.ajax({
                url: '/qlsanpham/store',
                type: 'POST',
                data: formData,
                success: function (response) {
                    alert('Sản phẩm đã được thêm thành công!');
                    $('#addModal').modal('hide');
                    location.reload();

                },
                error: function (xhr) {
                    if (xhr.responseJSON && xhr.responseJSON.errors) {
                        var errors = xhr.responseJSON.errors;

                        $.each(errors, function (field, message) {
                            $('#' + field + 'Error').text(message);
                        });
                    }
                }
            });
        });


        $('#productEditForm').on('submit', function (e) {
            e.preventDefault();  // Ngừng gửi form theo cách thông thường

            // Xóa các thông báo lỗi cũ
            $('.error').text('');

            var formData = $(this).serialize() + '&isAjax=true';  // Gửi dữ liệu với isAjax=true

            // Thực hiện gửi AJAX
            $.ajax({
                url: '/qlsanpham/update',  // Đường dẫn gửi request đến server
                type: 'POST',
                data: formData,
                success: function (response) {
                    alert('Cập nhật sản phẩm thành công!');
                    $('#editModal').modal('hide');  // Đóng modal sau khi thành công
                    location.reload();  // Tải lại trang nếu cần
                },
                error: function (xhr) {
                    if (xhr.responseJSON && xhr.responseJSON.errors) {
                        var errors = xhr.responseJSON.errors;  // Lấy thông báo lỗi từ response

                        // Duyệt qua các lỗi và hiển thị chúng trên các trường tương ứng
                        $.each(errors, function (field, message) {
                            $('#' + field + 'Error1').text(message);  // Hiển thị lỗi ở các thẻ với ID tương ứng
                        });
                    } else {
                        alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
                    }
                }
            });
        });

        formData.append('isAjax', 1);


        $.ajax({
            url: '/qlsanphamchitiet/store',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                alert('Sản phẩm chi tiết đã được thêm thành công!');
                $('#addModal2').modal('hide');
                location.reload();
                // window.location.href("http://localhost:8080/qlsanphamchitiet")
               // console.log("ababbab")

            },
            error: function (xhr) {
                console.log("Có lỗi xảy ra khi gửi yêu cầu AJAX.");
                if (xhr.responseJSON && xhr.responseJSON.errors) {
                    var errors = xhr.responseJSON.errors;
                    $.each(errors, function (field, message) {
                        $('#' + field + 'Error').text(message);
                    });
                } else {
                    alert('Có lỗi xảy ra. Mã lỗi: ' + xhr.status + ', Chi tiết: ' + xhr.statusText);
                }
            }
        });


        $('#productDetailEditForm').on('submit', function (e) {
            e.preventDefault();  // Ngừng gửi form theo cách thông thường

            // Xóa các thông báo lỗi cũ
            $('.error').text('');

            var formData = $(this).serialize() + '&isAjax=true';  // Gửi dữ liệu với isAjax=true

            // Thực hiện gửi AJAX
            $.ajax({
                url: '/qlsanphamchitiet/update',  // Đường dẫn gửi request đến server
                type: 'POST',
                data: formData,
                success: function (response) {
                    alert('Cập nhật sản phẩm chi tiết thành công!');
                    $('#editModal').modal('hide');  // Đóng modal sau khi thành công
                    location.reload();  // Tải lại trang nếu cần
                },
                error: function (xhr) {
                    if (xhr.responseJSON && xhr.responseJSON.errors) {
                        var errors = xhr.responseJSON.errors;  // Lấy thông báo lỗi từ response

                        // Duyệt qua các lỗi và hiển thị chúng trên các trường tương ứng
                        $.each(errors, function (field, message) {
                            $('#' + field + 'Error1').text(message);  // Hiển thị lỗi ở các thẻ với ID tương ứng
                        });
                    } else {
                        alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
                    }
                }
            });
        });

        $('#productEditForm').on('submit', function (e) {
            e.preventDefault();  // Ngừng gửi form theo cách thông thường

            // Xóa các thông báo lỗi cũ
            $('.error').text('');

            var formData = $(this).serialize() + '&isAjax=true';  // Gửi dữ liệu với isAjax=true

            // Thực hiện gửi AJAX
            $.ajax({
                url: '/qlsanpham/update',  // Đường dẫn gửi request đến server
                type: 'POST',
                data: formData,
                success: function (response) {
                    alert('Cập nhật sản phẩm thành công!');
                    $('#editModal').modal('hide');  // Đóng modal sau khi thành công
                    location.reload();  // Tải lại trang nếu cần
                },
                error: function (xhr) {
                    if (xhr.responseJSON && xhr.responseJSON.errors) {
                        var errors = xhr.responseJSON.errors;  // Lấy thông báo lỗi từ response

                        // Duyệt qua các lỗi và hiển thị chúng trên các trường tương ứng
                        $.each(errors, function (field, message) {
                            $('#' + field + 'Error1').text(message);  // Hiển thị lỗi ở các thẻ với ID tương ứng
                        });
                    } else {
                        alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
                    }
                }
            });
        });


    });

    // function previewImage(input) {
    //     let preview = document.getElementById('previewImage');
    //     let file = input.files[0];
    //
    //     if (file) {
    //         let reader = new FileReader();
    //
    //         reader.onload = function (e) {
    //             preview.src = e.target.result;
    //         }
    //         reader.readAsDataURL(file);
    //     }
    // }


    //     function previewImage(input) {
    //     const preview = document.getElementById('previewImage2');
    //
    //     if (input.files && input.files[0]) {
    //     const reader = new FileReader();
    //
    //     reader.onload = function (e) {
    //     preview.src = e.target.result; // Gán đường dẫn ảnh vào thẻ <img>
    //     preview.style.display = 'block'; // Hiển thị thẻ <img>
    // };
    //
    //     reader.readAsDataURL(input.files[0]); // Đọc file và convert thành DataURL
    // } else {
    //     preview.src = '#'; // Đặt lại giá trị khi không có file
    //     preview.style.display = 'none'; // Ẩn thẻ <img>
    // }}
</script>


</html>